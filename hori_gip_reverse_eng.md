# More info on Game Input Protocol (GIP)

[https://github.com/quantus/xbox-one-controller-protocol](https://github.com/quantus/xbox-one-controller-protocol)

[https://github.com/medusalix/xone/blob/master/bus/protocol.c](https://github.com/medusalix/xone/blob/master/bus/protocol.c)

[https://github.com/kylelemons/xbox](https://github.com/kylelemons/xbox)

[https://github.com/torvalds/linux/blob/master/drivers/input/joystick/xpad.c](https://github.com/torvalds/linux/blob/master/drivers/input/joystick/xpad.c)

[https://learn.microsoft.com/en-us/gaming/gdk/_content/gc/input/overviews/input-overview](https://learn.microsoft.com/en-us/gaming/gdk/_content/gc/input/overviews/input-overview)

# Revese Engineering Hori's Game Input Protocol (GIP) commands

The following are observations using the Hori Device Manager with the
Hori Fighting Commander Octa. The data was obtained by using Wireshark on
Linux while running Windows in a QEMU VM with direct access to the USB device.

Starting Hori Device Manager with Profil 1 active auf Controller:

`HOST>` is the data sent by the host.

`<PAD` is the data returned by the pad.

Both of these are Game Input Protocol (GIP) packets. They follow the following
structure (simplified to only those encountered in the Hori context):

```
struct gip_header {
	u8 command;  // 0x0f => Host to Controller, 0x10 => Controller to Host
	u8 options;  // always 0
	u8 sequence; // controller replies with the same sequence number
	u8 length;   // number of bytes in hori_command that follows
};

struct hori_command {
    u8 hori_cmd;
    u8 data[];
    u8 padding[]; // sometimes controller and host pad so gip_header+hori_command are 64 bytes
};
```

The controller isn't picky with the sequence numbers. You can use any sequence
number in requests sent to it. It will reply with the same sequence number as used
in the request. The sequence numbers used by the Hori Device Managers do not
continue the sequence used by the OS when talking to the controller.

## Hori Commands

`02` *Host to Controller*  Unsupported by Fighting Commander Octa.  Host waited 32ms for an answer, then continued.

`03` *Host to Controller*  Write Profile memory
```
u8 profile;     // 1..4 which profile to write to
u8 offset_hi;   // high byte of offset of 1st byte to write
u8 offset_lo;   // low byte of offset of 1st byte to write
u8 count;       // number of bytes to write, max. 55 because that's the max that fits in
                // a 64 byte message
u8 data[count]; // data to write
```
           
`04` *Host to Controller* Read profile memory 
```
u8 profile;     // 1..4 which profile to read from
u8 offset_hi;   // high byte of offset of 1st byte to read
u8 offset_lo;   // low byte of offset of 1st byte to read
u8 count;       // number of bytes to read, max. 55 because that's the max that fits in
                // a 64 byte message
```

`05` *Controller to Host* Profile memory contents, reply to `04` Read profile memory
```
u8 profile;     // 1..4 which profile the memory reported belongs to
u8 offset_hi;   // high byte of offset of 1st returned byte in profile memory
u8 offset_lo;   // low byte of offset of 1st byte
u8 count;       // number of bytes returned, max. 55 because that's the max that fits in
                // a 64 byte message
u8 data[count]; // data returned from profile memory
```

`06` *Controller to Host* Confirm operation done (sent after host requests `07` and `03`)

`07` *Host to Controller* Force controller to switch active profile
```
u8 profile;  // 1..4 profile to make new active profile
```

`09` *Host to Controller* Query firmware version ?? (reply is `0a` with a UTF16 string)

`0a` *Controller to Host* Report firmware version ?? (sent in reply to `09`)
```
UTF16_LE data[];  // little endian UTF16 characters
```

`0b` *Host to Controller* Query number of currently active profile, (reply is `0c`)

`0c` *Controller to Host* Report currently active profile (reply to `0b`)
```
u8 profile;    // 1..4 which profile is currently active
u8 unknown;    // always 1 ??
```

`0d` *Controller to Host* Report change in profile (button has been pressed)
```
u8 profile;    // 1..4 which profile is now active
```

## Profile memory layout

Each of the 4 profiles has its own profile memory with the same layout

| Offset | Description |
| ----------- | ----------- |
| 0000 | utf16[17] Profile name. Max 16 chars. 0-terminated. Each UTF16 char is little-endian.
| 0022 |
| 0029 | Headset Volume 0..100
| 002A | in-game volume vs voice chat balance 00(in-game volume loudest)...50(both equal)...100(voice | chat loudest)
| 002B | 00 => Mic Enabled, 01 => Mic Disabled  (with the Mute button)
| 002C | Mic Sensitivity 00(lowest)..04(highest)
| 0031 | up-right DPad sensitivity (max) 1e => 2a => 4c => 8f => be => e4 (min) ff allowed
| 0032 | down-right DPad sensitivity (max) 1e => 2a => 4c => 8f => be => e4 (min)
| 0033 | down-left DPad sensitivity (max) 1e => 2a => 4c => 8f => be => e4 (min)
| 0034 | up-left DPad sensitivity (max) 1e => 2a => 4c => 8f => be => e4 (min)
| 0035 | 0: DPad balanced mode on, 1: DPad balanced mode off. Sensitivity values are still used in balanced mode. The Hori Manager sets them to 01 for the cardinals and 20 for the diagonals
| 003f | up DPad sensitivity 00 allowed, (max) 01 => 1c => 4c => 8f => be => e4 (min)
| 004d | down DPad sensitivity (max)  01 => 1c => 4c => 8f => be => e4 (min)
| 005b | left DPad sensitivity (max) 01 => 1c => 4c => 8f => be => e4 (min)
| 0069 | right DPad sensitivity (max) 01 => 1c => 4c => 8f => be => e4 (min)
| 0073 | enable LB override: offset 0x7a enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 007a | LB (right index finger)
| 0081 | enable RB override: offset 0x88 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0088 | RB face button: 21 => disabled, 0 => ?, UP => 1, DOWN => 2, LEFT => 3, RIGHT => 4, LB => 5, RB => 6, LSB => 7, RSB => 8,  9=>?, 0a=>?, 0b=>?, 0c=>?, LT => 0d, RT => 0e,  0f => A, 10 => B, 11 => X, 12 => Y, 13=>?, 14=>?, 15=>GUIDE, 16=> SELECT, 17=>START,  18=>SHARE, 19=> left stick max down, 1a=>ls max up, 1b=>ls max left, 1c=>ls max right,  1d=>rs max down, 1e=>rs max up, 1f=>rs max left, 20=>rs max right
| 008f | enable LSB override: offset 0x96 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0096 | LSB (left index finger)
| 009d | enable RSB override: offset 0xa4 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 00a4 | RSB (left middle finger)
| 00e3 | enable LT override: offset 0xea enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 00ea | LT (right middle finger)
| 00f1 | enable RT override: offset 0xf8 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 00f8 | RT face button
| 00ff | enable A override: offset 0x106 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0106 | A button (south)
| 010d | enable B override: offset 0x114 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0114 | B button (east)
| 011b | enable X override: offset 0x122 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0122 | X button (west)
| 0129 | enable Y override: offset 0x130 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0130 | Y button (north)
|      | I tested the addresses in this gap and none of them remap either the analog stick button or the dpad's directions. That the dpad directions are not remappable isn't really unsuspected, but the stick button? The pad can even remap the SHARE button, a feature no one needs. As crazy as it sounds, I think the stick button is not  remappable, which of course explains why setting the analog stick to be the right stick does not automatically change the button to be RSB, which would be a pretty obvious thing to do if it was possible.
| 0153 | enable GUIDE override: offset 0x15a enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 015a | GUIDE button (X-Box Logo)
| 0161 | enable SELECT override: offset 0x168 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0168 | SELECT button (left of X-Box Logo)
| 016f | enable START override: offset 0x176 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0176 | START button (right of X-Box Logo)
| 017d | enable SHARE override: offset 0x184 enabled: 04 00 00 00 00 00 01, disabled: 00 00 00 00 00 00 00
| 0184 | SHARE button (below X-Box Logo)
| 018a | analog stick function: RIGHT: 01 00 00 01 00 00 02 00 01 00 00 01 00 00 01 00 00 01
| ...  | ditto                  LEFT:  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00
| 019b | ditto



## Communication when starting HDM

### Read profiles

The Hori Device Manager (HDM) starts by reading profile 1 completely.

```
HOST>
0040  0f 00 XX 3c 04 01 00 00 37 00 00 00 00 00 00 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 XX 3c 05 01 00 00 37 50 00 72 00 6f 00 66   ...<....7P.r.o.f
0050  00 69 00 6c 00 65 00 20 00 31 00 00 00 00 00 00   .i.l.e. .1......
0060  00 00 00 00 00 00 00 00 00 00 00 01 32 32 01 32   ............22.2
0070  32 01 32 32 00 02 00 00 00 00 20 20 20 20 00 00   2.22......    ..

HOST>
0040  0f 00 XX 3c 04 01 00 37 37 00 00 00 00 00 00 00   ...<...77.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 8a 3c 05 01 00 37 37 00 00 00 01 00 00 00   ...<...77.......
0050  00 01 5a 00 00 00 00 00 00 00 01 00 00 00 00 01   ..Z.............
0060  5a 00 00 00 00 00 00 00 01 00 00 00 00 01 5a 00   Z.............Z.
0070  00 00 00 00 00 00 01 00 00 00 00 01 5a 00 00 00   ............Z...
 
HOST>
0040  0f 00 03 3c 04 01 00 6e 37 00 00 00 00 00 00 00   ...<...n7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 03 3c 05 01 00 6e 37 00 00 00 00 01 00 00   ...<...n7.......
0050  00 00 00 00 00 00 00 00 00 00 00 01 04 00 00 00   ................
0060  00 00 01 02 00 00 00 00 00 01 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00   ................

HOST>
0040  0f 00 04 3c 04 01 00 a5 37 00 00 00 00 00 00 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 04 3c 05 01 00 a5 37 00 00 00 00 00 01 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00   ................

HOST>
0040  0f 00 05 3c 04 01 00 dc 37 00 00 00 00 00 00 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 05 3c 05 01 00 dc 37 00 00 00 00 00 00 01   ...<....7.......
0050  04 00 00 00 00 00 01 0d 00 00 00 00 00 01 04 00   ................
0060  00 00 00 00 01 01 00 00 00 00 00 01 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................

HOST>
0040  0f 00 06 3c 04 01 01 13 37 00 00 00 00 00 00 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 06 3c 05 01 01 13 37 00 00 00 00 00 00 00   ...<....7.......
0050  01 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 01 0c 00 00   ................
0070  00 00 00 01 13 01 37 37 00 00 01 0c 00 00 00 00   ......77........

HOST>
0040  0f 00 07 3c 04 01 01 4a 37 00 00 00 00 00 00 00   ...<...J7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 07 3c 05 01 01 4a 37 00 01 14 01 37 37 00   ...<...J7....77.
0050  00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 01   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................

HOST>
0040  0f 00 08 3c 04 01 01 81 24 00 00 00 00 00 00 00   ...<....$.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 08 3c 05 01 01 81 24 00 00 00 00 00 00 00   ...<....$.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 01 01 00 04 04 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................

```

Interesting to observe here is that for this last memory block the Hori Device
Manager is not requesting 55 bytes (0x37) but only 0x24==36. This means in total
the HDM reads 421==0x1a5 bytes from profile memory.

Next the HDM reads profile 2.

```
HOST>
0040  0f 00 09 3c 04 02 00 00 37 00 00 00 00 00 00 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 09 3c 05 02 00 00 37 50 00 72 00 6f 00 66   ...<....7P.r.o.f
0050  00 69 00 6c 00 65 00 20 00 32 00 00 00 00 00 00   .i.l.e. .2......
0060  00 00 00 00 00 00 00 00 00 00 00 01 32 32 01 32   ............22.2
0070  32 01 32 32 00 02 00 00 00 00 e4 e4 e4 e4 01 00   2.22............

...
```


#### Summary Profile 1

```

                                 50 00 72 00 6f 00 66   .........P.r.o.f
      00 69 00 6c 00 65 00 20 00 31 00 00 00 00 00 00   .i.l.e. .1......
      00 00 00 00 00 00 00 00 00 00 00 01 32 32 01 32   ............22.2
      32 01 32 32 00 02 00 00 00 00 20 20 20 20 00 00   2.22......    ..
                                 00 00 00 01 00 00 00   ................
      00 01 5a 00 00 00 00 00 00 00 01 00 00 00 00 01   ..Z.............
      5a 00 00 00 00 00 00 00 01 00 00 00 00 01 5a 00   Z.............Z.
      00 00 00 00 00 00 01 00 00 00 00 01 5a 00 00 00   ............Z...
                                 00 00 00 00 01 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 01 04 00 00 00   ................
      00 00 01 02 00 00 00 00 00 01 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 01 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 01   ................
      04 00 00 00 00 00 01 0d 00 00 00 00 00 01 04 00   ................
      00 00 00 00 01 01 00 00 00 00 00 01 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      01 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 01 0c 00 00   ................
      00 00 00 01 13 01 37 37 00 00 01 0c 00 00 00 00   ......77........
                                 00 01 14 01 37 37 00   .............77.
      00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 01   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 01 01 00 04 04 
```

#### Summary Profile 2:

```

                                 50 00 72 00 6f 00 66   .........P.r.o.f
      00 69 00 6c 00 65 00 20 00 32 00 00 00 00 00 00   .i.l.e. .2......
      00 00 00 00 00 00 00 00 00 00 00 01 32 32 01 32   ............22.2
      32 01 32 32 00 02 00 00 00 00 e4 e4 e4 e4 01 00   2.22............
                                 00 00 00 01 00 00 00   ................
      00 01 5a 00 00 00 00 00 00 00 01 00 00 00 00 01   ..Z.............
      5a 00 00 00 00 00 00 00 01 00 00 00 00 01 5a 00   Z.............Z.
      00 00 00 00 00 00 01 00 00 00 00 01 5a 00 00 00   ............Z...
                                 00 00 00 00 01 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 01 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 01   ................
      04 00 00 00 00 00 01 0d 00 00 00 00 00 01 04 00   ................
      00 00 00 00 01 0e 00 00 00 00 00 01 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      01 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 01 0c 00 00   ................
      00 00 00 01 13 01 37 37 00 00 01 0c 00 00 00 00   ......77........
                                 00 01 14 01 37 37 00   .............77.
      00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 01   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 01 01 00 04 04 
```

#### Summary Profile 3

This profile, unlike 1 and 2, has never been touched. So this would represent
the factory original state. Note that when HDM resets a profile to default
it does NOT write this pattern to the profile being reset.


```

                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 01 32 32 00 02 00 00 00 00 1e 1e 1e 1e 01 00   ..22............
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
                                 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
      00 00 00 00 00 00 00 00 00 00 00 00 00

```

#### Summary Profile 4

Never touched. Identical to Profile 3.

### Request active profile

```
HOST>
0040  0f 00 21 3c 0b 00 00 00 00 00 00 00 00 00 00 00   ..!<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 21 3c 0c 01 01 00 00 00 00 00 00 00 00 00   ..!<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

The above reply is when profile 1 is active. With profile 2 it's:


```
0040  10 00 c7 3c 0c 02 01 00 00 00 00 00 00 00 00 00   ...<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

### Read firmware version ???

I think this reads the firmware version, although the returned string
does not correspond to the firmware version as displayed in HDM.
Unfortunately I only started reverse engineering after updating to
the latest version, so I don't have any recording of this exchange
with the older firmware.

The firmware version for the controller in this case is 4.1.0.

```
HOST>
0040  0f 00 22 3c 09 00 00 00 00 00 00 00 00 00 00 00   .."<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD
0040  10 00 22 3c 0a 30 00 31 00 30 00 39 00 00 00 00   .."<.0.1.0.9....
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

### Unsupported request

The following request is sent by the HDM but the Hori Fighting Commander Octa
does not seem to support it. It does not reply. After a timeout of about 32ms,
the HDM gives up and continues.

```
HOST>
0040  0f 00 23 3c 02 00 00 00 00 00 00 00 00 00 00 00   ..#<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................

<PAD
```

### Request active profile (2nd time)

The HDM requests the number of the currently selected profile again:


```
HOST>
0040  0f 00 24 3c 0b 00 00 00 00 00 00 00 00 00 00 00   ..$<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................

<PAD
0040  10 00 24 3c 0c 01 01 00 00 00 00 00 00 00 00 00   ..$<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

### Read headset/mic settings

The HDM reads profile memory again. It only requests 5 bytes this time, the
5 bytes at 0x28 which encode headset volume, balance, mic on/off and mic sensitivity.
The HDM probably reads this data because it displays it continually on the title screen.

```
HOST>
0040  0f 00 25 05 04 01 00 28 05                        ..%....(.

<PAD
0040  10 00 25 3c 05 01 00 28 05 01 32 32 00 02 00 00   ..%<...(..22....
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```


```
0x28 ??? always 01 ?
0x29 Headset Volume 0..100
0x2A in-game volume vs voice chat balance
     00(in-game volume loudest)...50(both equal)...100(voice chat loudest)
0x2B 00 => Mic Enabled, 01 => Mic Disabled  (with the Mute button)
0x2C Mic Sensitivity 00(lowest)..04(highest)
```

### Read loop for title screen

The HDM now continually reads the currently selected profile number and the
audio settings for that profile because it displays this on the title screen.


## Some interactions
         
Report change in profile (when button is pressed on pad):
```
0040  10 00 ec 3c 0d 04 00 00 00 00 00 00 00 00 00 00   ...<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Force switch to profile by host:
```
HOST>
0040  0f 00 f0 3c 07 04 00 00 00 00 00 00 00 00 00 00   ...<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
<PAD (after 16ms)
0040  10 00 f0 3c 06 00 00 00 00 00 00 00 00 00 00 00   ...<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Change profile name to ÖÄÜÖÄÖÜÖÄÖÄÖÄÖÄÖ (Ö=0x00d6, Ä=0x00c4, Ü=0x00DC)

```
HOST>
0040  0f 00 3e 3c 03 02 00 00 37 d6 00 c4 00 dc 00 d6   ..><....7.......
0050  00 c4 00 d6 00 dc 00 d6 00 c4 00 d6 00 c4 00 d6   ................
0060  00 c4 00 d6 00 c4 00 d6 00 00 00 01 32 32 01 32   ............22.2
0070  32 01 32 32 00 00 00 00 00 00 20 20 20 20 00 00   2.22......    ..
<PAD (after 24ms)
0040  10 00 3e 3c 06 00 00 00 00 00 00 00 00 00 00 00   ..><............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Interestingly the HDM did not just write the profile name, but also some
more stuff in the profile memory. A total of 0x37+0x34==107 bytes were written

```
HOST> 
0040  0f 00 3f 3c 03 02 00 37 34 00 00 00 01 02 00 00   ..?<...74.......
0050  00 01 02 00 00 00 00 00 00 00 01 02 00 00 00 01   ................
0060  02 00 00 00 00 00 00 00 01 02 00 00 00 01 02 00   ................
0070  00 00 00 00 00 00 01 02 00 00 00 01 02 00 00 00   ................
<PAD (after 32ms)
0040  10 00 3f 3c 06 00 00 00 00 00 00 00 00 00 00 00   ..?<............
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Interestingly, reading back the memory did not result in all the same data but
some differences. Some bytes of profile memory seem to be locked against writing or
are transformed by the firmware when processing a write command.


Initialize Profile 3 (rename it to "P 3" after it had not previously been touched at all)
After every block the host waits for the pad to send an 06 acknowledgement.

```
0040  0f 00 7d 3c 03 03 00 00 37 50 00 20 00 33 00 00   ..}<....7P. .3..
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 01 32 32 01 32   ............22.2
0070  32 01 32 32 00 02 00 00 00 00 1e 1e 1e 1e 01 00   2.22............
0040  0f 00 7e 3c 03 03 00 37 37 00 00 00 01 02 00 00   ..~<...77.......
0050  00 01 02 00 00 00 00 00 00 00 01 02 00 00 00 01   ................
0060  02 00 00 00 00 00 00 00 01 02 00 00 00 01 02 00   ................
0070  00 00 00 00 00 00 01 02 00 00 00 01 02 00 00 00   ................
0040  0f 00 7f 3c 03 03 00 6e 37 00 00 00 00 01 00 00   ...<...n7.......
0050  00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00   ................
0040  0f 00 80 3c 03 03 00 a5 37 00 00 00 00 00 01 00   ...<....7.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 01 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00   ................
0040  0f 00 81 3c 03 03 00 dc 37 00 00 00 00 00 00 01   ...<....7.......
0050  04 00 00 00 00 00 01 0d 00 00 00 00 00 01 04 00   ................
0060  00 00 00 00 01 0e 00 00 00 00 00 01 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................
0040  0f 00 82 3c 03 03 01 13 37 00 00 00 00 00 00 00   ...<....7.......
0050  01 00 00 00 00 00 00 00 00 00 00 00 00 00 01 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 01 0c 00 00   ................
0070  00 00 00 01 13 01 37 37 00 00 01 0c 00 00 00 00   ......77........
0040  0f 00 83 3c 03 03 01 4a 37 00 01 14 01 37 37 00   ...<...J7....77.
0050  00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 01   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 01 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
0040  0f 00 84 3c 03 03 01 81 24 00 00 00 00 00 00 00   ...<....$.......
0050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 01 01 00 04 04 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Reset Profile 1 to default. Note that the writing starts at address 0x20, i.e. after
the profile name. Interestingly this only writes up to byte 414, whereas the
initial initialization of Profile 3 above writes up to byte 421

```
0040  0f 00 5a 3c 03 01 00 20 37 00 00 01 32 32 01 32   ..Z<... 7...22.2
0050  32 01 32 32 00 00 00 00 00 00 20 20 20 20 00 00   2.22......    ..
0060  00 00 00 01 02 00 00 00 01 02 00 00 00 00 00 00   ................
0070  00 01 02 00 00 00 01 02 00 00 00 00 00 00 00 01   ................
0040  0f 00 5b 3c 03 01 00 57 37 02 00 00 00 01 02 00   ..[<...W7.......
0050  00 00 00 00 00 00 01 02 00 00 00 01 02 00 00 00   ................
0060  00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0040  0f 00 5c 3c 03 01 00 8e 37 01 00 00 00 00 00 00   ..\<....7.......
0050  00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00   ................
0040  0f 00 5d 3c 03 01 00 c5 37 00 01 00 00 00 00 00   ..]<....7.......
0050  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 01 04 00 00 00 00 00 01 0d 00   ................
0070  00 00 00 00 01 04 00 00 00 00 00 01 0e 00 00 00   ................
0040  0f 00 5e 3c 03 01 00 fc 37 00 00 01 00 00 00 00   ..^<....7.......
0050  00 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00   ................
0060  00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00   ................
0040  0f 00 5f 3c 03 01 01 33 37 00 00 00 01 0c 00 00   .._<...37.......
0050  00 00 00 01 13 01 37 37 00 00 01 0c 00 00 00 00   ......77........
0060  00 01 14 01 37 37 00 00 01 00 00 00 00 00 00 00   ....77..........
0070  00 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00   ................
0040  0f 00 60 3c 03 01 01 6a 34 00 00 00 00 01 00 00   ..`<...j4.......
0050  00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 01 00 00 00 00 00 00 00 00 00 00 01 00 00 00   ................
```

Mute volume in Profile 1. 
```
0040  0f 00 01 3c 03 01 00 20 0a 00 00 01 32 32 01 32   ...<... ....22.2
0050  32 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00   2...............
0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Change RB => Disabled in Profile 1:
```
HOST>
0040  0f 00 XX 3c 03 01 00 81 08 04 00 00 00 00 00 01   ...<............
0050  21   !...............
<PAD
06 OPERATION DONE
```

RB => A in Profile 2:
```
HOST>
0040  0f 00 d9 3c 03 02 00 81 08 04 00 00 00 00 00 01   ...<............
0050  0f    ................
```

RB => B in Profile 2:
```
0040   0f 00 7c 3c 03 02 00 88 01 10 
```

Switch analog stick from left to right in Profile 2:
```
0040   0f 00 3f 3c 03 02 01 8a 12 01 00 00 01 00 00 02   ..?<............
0050   00 01 00 00 01 00 00 01 00 00 01 00 00 00 00 00   ................
0060   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

Switch analog stick from right to left in Profile 2:
```
0040   0f 00 fd 3c 03 02 01 8a 12 00 00 00 00 00 00 00   ...<............
0050   00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0060   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
0070   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
```

